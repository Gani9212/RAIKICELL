<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pembukuan WiFi RT/RW Net</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: #0d0d0d;
      color: #00ffc3;
    }
    header, nav, .tabcontent {
      padding: 20px;
    }
    header {
      background: #111;
      font-size: 24px;
      text-align: center;
      border-bottom: 2px solid #00ffc3;
    }
    nav {
      display: flex;
      background: #181818;
      border-bottom: 1px solid #00ffc3;
    }
    nav button {
      flex: 1;
      padding: 15px;
      border: none;
      background: none;
      color: #00ffc3;
      font-weight: bold;
      cursor: pointer;
    }
    nav button:hover, nav button.active {
      background-color: #00ffc3;
      color: black;
    }
    .tabcontent {
      display: none;
    }
    .tabcontent.active {
      display: block;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border: none;
      font-family: 'Orbitron', sans-serif;
    }
    button {
      background: #00ffc3;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: #1f1f1f;
      margin-bottom: 10px;
      padding: 10px;
      border-left: 4px solid #00ffc3;
      display: flex;
      justify-content: space-between;
    }
    #login {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #mainApp {
      display: none;
    }
    small {
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div id="login">
    <h2>Login Admin</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="mainApp">
    <header>ðŸ“¡ Pembukuan WiFi RT/RW Net</header>
    <nav>
      <button onclick="openTab('dashboard')" class="active">Dashboard</button>
      <button onclick="openTab('voucher')">Pelanggan Voucher</button>
      <button onclick="openTab('pppoe')">Pelanggan PPPoE</button>
      <button onclick="openTab('pembayaran')">Pembayaran</button>
    </nav>

    <div id="dashboard" class="tabcontent active">
      <h2>ðŸ“Š Statistik Pembayaran</h2>
      <canvas id="chartPembayaran"></canvas>
      <div id="laporanBulanan"></div>
    </div>

    <div id="voucher" class="tabcontent">
      <h2>ðŸ“‹ Pelanggan Voucher</h2>
      <form onsubmit="tambahPelanggan(event, 'Voucher')">
        <input type="text" id="namaVoucher" placeholder="Nama">
        <input type="text" id="paketVoucher" placeholder="Paket">
        <input type="number" id="biayaVoucher" placeholder="Biaya">
        <button type="submit">Tambah</button>
      </form>
      <ul id="listVoucher"></ul>
    </div>

    <div id="pppoe" class="tabcontent">
      <h2>ðŸ“‹ Pelanggan PPPoE</h2>
      <form onsubmit="tambahPelanggan(event, 'PPPoE')">
        <input type="text" id="namaPPPoE" placeholder="Nama">
        <input type="text" id="paketPPPoE" placeholder="Paket">
        <input type="number" id="biayaPPPoE" placeholder="Biaya">
        <button type="submit">Tambah</button>
      </form>
      <ul id="listPPPoE"></ul>
    </div>

    <div id="pembayaran" class="tabcontent">
      <h2>ðŸ’° Input Pembayaran</h2>
      <form onsubmit="tambahPembayaran(event)">
        <input type="text" id="namaBayar" placeholder="Nama Pelanggan">
        <input type="number" id="jumlahBayar" placeholder="Jumlah Pembayaran">
        <input type="month" id="bulanBayar">
        <button type="submit">Simpan</button>
      </form>
      <h3>ðŸ§¾ Riwayat Pembayaran</h3>
      <ul id="riwayatPembayaran"></ul>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCoI53ZeXyaOBCOaczkPbHJpWzi0DX4b8g",
      authDomain: "raikicell.firebaseapp.com",
      databaseURL: "https://raikicell-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "raikicell",
      storageBucket: "raikicell.firebasestorage.app",
      messagingSenderId: "648628376778",
      appId: "1:648628376778:web:961ca9084abeeb206bd033",
      measurementId: "G-JG8V2E41XR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.login = function() {
      const user = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      if (user === 'Raikinet' && pass === 'Cintawargi1909') {
        document.getElementById('login').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        muatSemua();
      } else {
        alert('Login gagal!');
      }
    }

    window.openTab = function(id) {
      document.querySelectorAll('.tabcontent').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
    }

    window.tambahPelanggan = async function(e, jenis) {
      e.preventDefault();
      const nama = document.getElementById('nama' + jenis).value;
      const paket = document.getElementById('paket' + jenis).value;
      const biaya = parseInt(document.getElementById('biaya' + jenis).value);
      await addDoc(collection(db, 'pelanggan'), { nama, paket, biaya, jenis });
      muatSemua();
    }

    window.editNama = async function(id, namaBaru) {
      const ref = doc(db, 'pelanggan', id);
      await updateDoc(ref, { nama: namaBaru });
      muatSemua();
    }

    window.tambahPembayaran = async function(e) {
      e.preventDefault();
      const nama = document.getElementById('namaBayar').value;
      const jumlah = parseInt(document.getElementById('jumlahBayar').value);
      const bulan = document.getElementById('bulanBayar').value;
      await addDoc(collection(db, 'pembayaran'), { nama, jumlah, bulan });
      muatSemua();
    }

    async function muatSemua() {
      const voucher = document.getElementById('listVoucher');
      const pppoe = document.getElementById('listPPPoE');
      const riwayat = document.getElementById('riwayatPembayaran');
      voucher.innerHTML = '';
      pppoe.innerHTML = '';
      riwayat.innerHTML = '';

      const pelanggans = await getDocs(collection(db, 'pelanggan'));
      pelanggans.forEach(p => {
        const d = p.data();
        const li = document.createElement('li');
        li.innerHTML = `${d.nama} - ${d.paket} (Rp${d.biaya}) <button onclick="ubahNama('${p.id}', '${d.nama}')">Edit</button>`;
        if (d.jenis === 'Voucher') voucher.appendChild(li);
        else pppoe.appendChild(li);
      });

      const bayars = await getDocs(collection(db, 'pembayaran'));
      const laporan = {};
      bayars.forEach(b => {
        const d = b.data();
        const li = document.createElement('li');
        li.textContent = `${d.nama} - Rp${d.jumlah} (${d.bulan})`;
        riwayat.appendChild(li);
        laporan[d.bulan] = (laporan[d.bulan] || 0) + d.jumlah;
      });

      const labels = Object.keys(laporan);
      const data = Object.values(laporan);
      const ctx = document.getElementById('chartPembayaran').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Total Pembayaran',
            data,
            backgroundColor: '#00ffc3'
          }]
        }
      });
    }

    window.ubahNama = function(id, namaLama) {
      const baru = prompt('Ubah nama:', namaLama);
      if (baru) editNama(id, baru);
    }
  </script>
</body>
</html>
