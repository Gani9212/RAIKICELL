<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Aplikasi Pembukuan Raikicell + Firebase</title>
  <style>
    /* ... CSS kamu ... */
  </style>
</head>
<body>

<!-- Sidebar & Tab Content (sesuaikan sesuai kode awal kamu) -->
<div id="sidebar">
  <button class="tab-btn active" data-tab="konter">Konter</button>
  <button class="tab-btn" data-tab="warung">Warung</button>
  <button class="tab-btn" data-tab="pengeluaran">Pengeluaran</button>
  <button class="tab-btn" data-tab="tarikTunai">Tarik Tunai</button>
  <button class="tab-btn" data-tab="admin">Admin Barang</button>
  <button class="tab-btn" data-tab="laporan">Laporan</button>
</div>

<section class="tab-content" id="konter">
  <!-- Form Konter dan tabel transaksiKonter -->
  <!-- Isi form dan tabel sesuai kode awal kamu -->
  <form id="formKonter">
    <input id="namaBarangKonter" placeholder="Nama Barang" required />
    <input id="hargaKonter" type="number" min="0" placeholder="Harga" required />
    <input id="feeKonter" type="number" min="0" placeholder="Fee" required />
    <button type="submit">Tambah Konter</button>
  </form>
  <table id="tableKonter">
    <thead><tr><th>Nama</th><th>Harga</th><th>Fee</th><th>Tanggal</th><th>Aksi</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<!-- Tab content untuk warung, pengeluaran, tarik tunai, admin, laporan sesuai kode awal -->

<!-- ... bagian lain (tab-content warung, pengeluaran, tarikTunai, admin, laporan) ... -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCoI53ZeXyaOBCOaczkPbHJpWzi0DX4b8g",
    authDomain: "raikicell.firebaseapp.com",
    databaseURL: "https://raikicell-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "raikicell",
    storageBucket: "raikicell.firebasestorage.app",
    messagingSenderId: "648628376778",
    appId: "1:648628376778:web:70098faf30f123ed6bd033",
    measurementId: "G-WWT1K74HHR"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app);

  // Data cache
  let transaksiKonter = [];
  let transaksiWarung = [];
  let pengeluaran = [];
  let tarikTunai = [];
  let daftarBarangAdmin = [];

  // Fungsi format rupiah
  function formatRupiah(num) {
    return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  }

  // Save ke firebase per jenis data
  function saveData(type, data) {
    // overwrite data pada path /{type}
    set(ref(db, type), data);
  }

  // Load data sekali dari firebase
  async function loadData() {
    const types = ['transaksiKonter','transaksiWarung','pengeluaran','tarikTunai','daftarBarangAdmin'];
    for (const type of types) {
      const snapshot = await get(ref(db, type));
      if (snapshot.exists()) {
        switch(type) {
          case 'transaksiKonter': transaksiKonter = snapshot.val() || []; break;
          case 'transaksiWarung': transaksiWarung = snapshot.val() || []; break;
          case 'pengeluaran': pengeluaran = snapshot.val() || []; break;
          case 'tarikTunai': tarikTunai = snapshot.val() || []; break;
          case 'daftarBarangAdmin': daftarBarangAdmin = snapshot.val() || []; break;
        }
      } else {
        // Jika belum ada data, set ke array kosong
        switch(type) {
          case 'transaksiKonter': transaksiKonter = []; break;
          case 'transaksiWarung': transaksiWarung = []; break;
          case 'pengeluaran': pengeluaran = []; break;
          case 'tarikTunai': tarikTunai = []; break;
          case 'daftarBarangAdmin': daftarBarangAdmin = []; break;
        }
      }
    }
  }

  // Render tabel dan update laba (kamu bisa salin fungsi render dari kode lama kamu)
  function renderTableKonter() {
    const tbody = document.querySelector('#tableKonter tbody');
    tbody.innerHTML = '';
    transaksiKonter.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${formatRupiah(item.harga)}</td>
        <td>${formatRupiah(item.fee)}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-button" data-index="${i}" data-type="konter">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ... buat renderTableWarung, renderTablePengeluaran, renderTableTarikTunai, renderTableAdmin dengan pola sama ...

  // Update laba total
  function updateLaba() {
    let labaKotor = 0;
    let labaBersih = 0;

    transaksiKonter.forEach(d => {
      labaKotor += d.harga + d.fee;
      labaBersih += d.fee;
    });
    transaksiWarung.forEach(d => {
      labaKotor += d.harga + d.fee;
      labaBersih += d.fee;
    });
    pengeluaran.forEach(d => {
      labaKotor -= d.jumlah;
    });
    tarikTunai.forEach(d => {
      labaKotor -= d.jumlah;
      labaBersih += d.fee;
    });

    document.getElementById('totalLabaKotor').textContent = formatRupiah(labaKotor);
    document.getElementById('totalLabaBersih').textContent = formatRupiah(labaBersih);
  }

  // Render semua
  function renderAll() {
    renderTableKonter();
    // renderTableWarung();
    // renderTablePengeluaran();
    // renderTableTarikTunai();
    // renderTableAdmin(document.getElementById('searchBarang')?.value || '');
    updateLaba();
  }

  // Hapus item (update di array lalu simpan ulang ke firebase)
  function deleteItem(type, index) {
    if (!confirm('Yakin hapus data ini?')) return;
    switch(type) {
      case 'konter': transaksiKonter.splice(index, 1); saveData('transaksiKonter', transaksiKonter); break;
      case 'warung': transaksiWarung.splice(index, 1); saveData('transaksiWarung', transaksiWarung); break;
      case 'pengeluaran': pengeluaran.splice(index, 1); saveData('pengeluaran', pengeluaran); break;
      case 'tarikTunai': tarikTunai.splice(index, 1); saveData('tarikTunai', tarikTunai); break;
      case 'admin': daftarBarangAdmin.splice(index, 1); saveData('daftarBarangAdmin', daftarBarangAdmin); break;
    }
    renderAll();
  }

  // Event form Konter submit
  document.getElementById('formKonter').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangKonter').value.trim();
    const harga = parseInt(document.getElementById('hargaKonter').value);
    const fee = parseInt(document.getElementById('feeKonter').value);
    if (!nama || isNaN(harga) || isNaN(fee) || harga < 0 || fee < 0) return alert('Input tidak valid!');
    transaksiKonter.push({
      nama, harga, fee,
      tanggal: new Date().toISOString().slice(0,10)
    });
    saveData('transaksiKonter', transaksiKonter);
    renderAll();
    e.target.reset();
  });

  // Delete button event listener
  document.body.addEventListener('click', e => {
    if (e.target.classList.contains('delete-button')) {
      const idx = parseInt(e.target.dataset.index);
      const type = e.target.dataset.type;
      deleteItem(type, idx);
    }
  });

  // Load data dan render saat page siap
  loadData().then(() => {
    renderAll();
  });

</script>

</body>
</html>
