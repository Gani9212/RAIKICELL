<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RNV Net</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daisyui@3.8.1/dist/full.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCoI53ZeXyaOBCOaczkPbHJpWzi0DX4b8g",
      authDomain: "raikicell.firebaseapp.com",
      databaseURL: "https://raikicell-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "raikicell",
      storageBucket: "raikicell.firebasestorage.app",
      messagingSenderId: "648628376778",
      appId: "1:648628376778:web:961ca9084abeeb206bd033",
      measurementId: "G-JG8V2E41XR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Simulasi login
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === "Raikinet" && pass === "Cintawargi1909") {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("mainApp").style.display = "block";
        loadAllData();
      } else {
        alert("Username atau Password salah");
      }
    });

    // Fungsi load semua data (pelanggan dan tagihan)
    async function loadAllData() {
      await loadPelanggan("voucher", "listVoucher");
      await loadPelanggan("pppoe", "listPPPoE");
      await loadTagihan();
    }

    async function loadPelanggan(tipe, listId) {
      const q = collection(db, `pelanggan_${tipe}`);
      const snapshot = await getDocs(q);
      const list = document.getElementById(listId);
      list.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "p-2 border rounded flex justify-between items-center mb-2 bg-base-200";
        div.innerHTML = `
          <div>
            <strong>${data.nama}</strong><br>
            No HP: ${data.hp}<br>
            Tgl Pasang: ${data.tanggal}
          </div>
          <div class="flex gap-2">
            <button onclick="editPelanggan('${tipe}', '${docSnap.id}', '${data.nama}', '${data.hp}', '${data.tanggal}')" class="btn btn-sm btn-warning">Edit</button>
            <button onclick="hapusPelanggan('${tipe}', '${docSnap.id}')" class="btn btn-sm btn-error">Hapus</button>
          </div>`;
        list.appendChild(div);
      });
    }

    async function hapusPelanggan(tipe, id) {
      await deleteDoc(doc(db, `pelanggan_${tipe}`, id));
      loadAllData();
    }

    window.editPelanggan = (tipe, id, nama, hp, tanggal) => {
      const namaBaru = prompt("Nama:", nama);
      const hpBaru = prompt("Nomor HP:", hp);
      const tanggalBaru = prompt("Tanggal Pasang:", tanggal);
      if (namaBaru && hpBaru && tanggalBaru) {
        updateDoc(doc(db, `pelanggan_${tipe}`, id), { nama: namaBaru, hp: hpBaru, tanggal: tanggalBaru });
        loadAllData();
      }
    }

    document.getElementById("formVoucher").addEventListener("submit", async e => {
      e.preventDefault();
      const nama = e.target.nama.value;
      const hp = e.target.hp.value;
      const tanggal = e.target.tanggal.value;
      await addDoc(collection(db, "pelanggan_voucher"), { nama, hp, tanggal });
      e.target.reset();
      loadAllData();
    });

    document.getElementById("formPPPoE").addEventListener("submit", async e => {
      e.preventDefault();
      const nama = e.target.nama.value;
      const hp = e.target.hp.value;
      const tanggal = e.target.tanggal.value;
      await addDoc(collection(db, "pelanggan_pppoe"), { nama, hp, tanggal });
      e.target.reset();
      loadAllData();
    });

    async function loadTagihan() {
      const q = collection(db, "tagihan");
      const snapshot = await getDocs(q);
      const list = document.getElementById("listTagihan");
      list.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "p-2 border rounded mb-2 bg-base-200";
        div.innerHTML = `
          <div class="flex justify-between">
            <div>
              <strong>${data.nama}</strong><br>
              Tagihan: ${data.jumlah} | Bulan: ${data.bulan}
            </div>
            <div class="flex gap-2">
              <button onclick="editTagihan('${docSnap.id}', '${data.nama}', '${data.jumlah}', '${data.bulan}')" class="btn btn-sm btn-warning">Edit</button>
              <button onclick="hapusTagihan('${docSnap.id}')" class="btn btn-sm btn-error">Hapus</button>
            </div>
          </div>`;
        list.appendChild(div);
      });
    }

    window.editTagihan = (id, nama, jumlah, bulan) => {
      const namaBaru = prompt("Nama:", nama);
      const jumlahBaru = prompt("Jumlah:", jumlah);
      const bulanBaru = prompt("Bulan:", bulan);
      if (namaBaru && jumlahBaru && bulanBaru) {
        updateDoc(doc(db, "tagihan", id), { nama: namaBaru, jumlah: jumlahBaru, bulan: bulanBaru });
        loadAllData();
      }
    }

    window.hapusTagihan = async id => {
      await deleteDoc(doc(db, "tagihan", id));
      loadAllData();
    }

    document.getElementById("formTagihan").addEventListener("submit", async e => {
      e.preventDefault();
      const nama = e.target.nama.value;
      const jumlah = e.target.jumlah.value;
      const bulan = e.target.bulan.value;
      await addDoc(collection(db, "tagihan"), { nama, jumlah, bulan });
      e.target.reset();
      loadAllData();
    });
  </script>
</head>
<body class="bg-base-100 text-base-content">
  <section id="loginSection" class="min-h-screen flex items-center justify-center">
    <form id="loginForm" class="p-6 bg-base-200 rounded shadow-md w-96">
      <h2 class="text-xl font-bold mb-4 text-center">Login Admin RNV Net</h2>
      <input id="username" placeholder="Username" class="input input-bordered w-full mb-2" required>
      <input id="password" type="password" placeholder="Password" class="input input-bordered w-full mb-4" required>
      <button class="btn btn-primary w-full">Login</button>
    </form>
  </section>

  <main id="mainApp" class="hidden">
    <div class="tabs tabs-boxed flex justify-center py-4">
      <a href="#dashboard" class="tab tab-active">Dashboard</a>
      <a href="#voucher" class="tab">Pelanggan Voucher</a>
      <a href="#pppoe" class="tab">Pelanggan PPPoE</a>
      <a href="#pembayaran" class="tab">Pembayaran</a>
    </div>

    <section id="dashboard" class="p-4">
      <div class="text-center">
        <h1 class="text-4xl font-bold mb-4">Selamat Datang di RNV Net</h1>
        <div class="mockup-code bg-primary text-primary-content text-left">
          <pre data-prefix="$"><code>ðŸ“¡ Internet Berkualitas untuk Warga</code></pre>
          <pre data-prefix=">" class="text-success"><code>ðŸš€ Stabil, Cepat, dan Terjangkau</code></pre>
          <pre data-prefix="âœ”"><code>ðŸ’¡ Laporan dan Manajemen Otomatis</code></pre>
        </div>
      </div>
    </section>

    <section id="voucher" class="p-4">
      <h2 class="text-xl font-bold mb-2">Pelanggan Voucher</h2>
      <form id="formVoucher" class="flex flex-col gap-2 mb-4">
        <input name="nama" placeholder="Nama" class="input input-bordered" required>
        <input name="hp" placeholder="Nomor HP" class="input input-bordered" required>
        <input name="tanggal" type="date" class="input input-bordered" required>
        <button class="btn btn-success">Tambah</button>
      </form>
      <div id="listVoucher"></div>
    </section>

    <section id="pppoe" class="p-4">
      <h2 class="text-xl font-bold mb-2">Pelanggan PPPoE</h2>
      <form id="formPPPoE" class="flex flex-col gap-2 mb-4">
        <input name="nama" placeholder="Nama" class="input input-bordered" required>
        <input name="hp" placeholder="Nomor HP" class="input input-bordered" required>
        <input name="tanggal" type="date" class="input input-bordered" required>
        <button class="btn btn-success">Tambah</button>
      </form>
      <div id="listPPPoE"></div>
    </section>

    <section id="pembayaran" class="p-4">
      <h2 class="text-xl font-bold mb-2">Daftar Tagihan</h2>
      <form id="formTagihan" class="flex flex-col gap-2 mb-4">
        <input name="nama" placeholder="Nama Pelanggan" class="input input-bordered" required>
        <input name="jumlah" placeholder="Jumlah Tagihan" class="input input-bordered" required>
        <input name="bulan" placeholder="Bulan" class="input input-bordered" required>
        <button class="btn btn-success">Tambah Tagihan</button>
      </form>
      <div id="listTagihan"></div>
    </section>
  </main>
</body>
</html>
