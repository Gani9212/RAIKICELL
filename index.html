<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Website Pembukuan Usaha dengan Firebase Modular SDK</title>
<style>
  /* CSS sesuai kode kamu */
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  #sidebar { width: 200px; background: #222; color: #fff; height: 100vh; float: left; }
  #sidebar .tab-btn { display: block; padding: 15px; cursor: pointer; border: none; background: #222; color: #fff; width: 100%; text-align: left; }
  #sidebar .tab-btn.active { background: #555; }
  .content { margin-left: 200px; padding: 20px; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  button.delete-btn { background: #d33; color: #fff; border: none; padding: 5px 10px; cursor: pointer; }
</style>
</head>
<body>

<div id="sidebar">
  <button class="tab-btn active" data-tab="konter">Transaksi Konter</button>
  <button class="tab-btn" data-tab="warung">Transaksi Warung</button>
  <button class="tab-btn" data-tab="pengeluaran">Pengeluaran</button>
  <button class="tab-btn" data-tab="tariktunai">Tarik Tunai</button>
  <button class="tab-btn" data-tab="admin">Admin Barang</button>
  <button class="tab-btn" data-tab="laporan">Laporan</button>
</div>

<div class="content">
  <div id="konter" class="tab-content active">
    <h2>Transaksi Konter</h2>
    <form id="formKonter">
      <input type="text" id="namaBarangKonter" placeholder="Nama Barang" required />
      <input type="number" id="hargaKonter" placeholder="Harga Jual" required min="0" />
      <input type="number" id="feeKonter" placeholder="Fee" required min="0" />
      <button type="submit">Tambah</button>
    </form>
    <table id="tableKonter">
      <thead><tr><th>Nama</th><th>Harga</th><th>Fee</th><th>Tanggal</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="warung" class="tab-content">
    <h2>Transaksi Warung</h2>
    <form id="formWarung">
      <input type="text" id="namaBarangWarung" placeholder="Nama Barang" required />
      <input type="number" id="hargaWarung" placeholder="Harga Jual" required min="0" />
      <input type="number" id="feeWarung" placeholder="Fee" required min="0" />
      <button type="submit">Tambah</button>
    </form>
    <table id="tableWarung">
      <thead><tr><th>Nama</th><th>Harga</th><th>Fee</th><th>Tanggal</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="pengeluaran" class="tab-content">
    <h2>Pengeluaran</h2>
    <form id="formPengeluaran">
      <input type="text" id="namaPengeluaran" placeholder="Nama Pengeluaran" required />
      <input type="number" id="hargaPengeluaran" placeholder="Harga" required min="0" />
      <button type="submit">Tambah</button>
    </form>
    <table id="tablePengeluaran">
      <thead><tr><th>Nama</th><th>Harga</th><th>Tanggal</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="tariktunai" class="tab-content">
    <h2>Tarik Tunai</h2>
    <form id="formTarikTunai">
      <input type="text" id="namaTarikTunai" placeholder="Keterangan" required />
      <input type="number" id="hargaTarikTunai" placeholder="Jumlah" required min="0" />
      <button type="submit">Tambah</button>
    </form>
    <table id="tableTarikTunai">
      <thead><tr><th>Keterangan</th><th>Jumlah</th><th>Tanggal</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="admin" class="tab-content">
    <h2>Admin Barang</h2>
    <form id="formAdminBarang">
      <input type="text" id="namaBarangAdmin" placeholder="Nama Barang" required />
      <input type="number" id="hargaBeliAdmin" placeholder="Harga Beli" required min="0" />
      <input type="number" id="hargaJualAdmin" placeholder="Harga Jual" required min="0" />
      <button type="submit">Tambah</button>
    </form>
    <input type="text" id="searchBarang" placeholder="Cari Barang..." />
    <table id="tableAdminBarang">
      <thead><tr><th>Nama</th><th>Harga Beli</th><th>Harga Jual</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="laporan" class="tab-content">
    <h2>Laporan</h2>
    <p>Total Keuntungan: <span id="totalKeuntungan">0</span></p>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCoI53ZeXyaOBCOaczkPbHJpWzi0DX4b8g",
    authDomain: "raikicell.firebaseapp.com",
    databaseURL: "https://raikicell-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "raikicell",
    storageBucket: "raikicell.firebasestorage.app",
    messagingSenderId: "648628376778",
    appId: "1:648628376778:web:70098faf30f123ed6bd033",
    measurementId: "G-WWT1K74HHR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let transaksiKonter = [];
  let transaksiWarung = [];
  let pengeluaran = [];
  let tarikTunai = [];
  let daftarBarangAdmin = [];

  // DOM references
  const tabButtons = document.querySelectorAll('#sidebar .tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  // Tab switching
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });

  async function loadData() {
    try {
      const snapshot = await get(ref(db, '/'));
      const data = snapshot.val() || {};
      transaksiKonter = data.transaksiKonter || [];
      transaksiWarung = data.transaksiWarung || [];
      pengeluaran = data.pengeluaran || [];
      tarikTunai = data.tarikTunai || [];
      daftarBarangAdmin = data.daftarBarangAdmin || [];
    } catch (error) {
      alert('Gagal memuat data dari Firebase: ' + error.message);
    }
  }

  async function saveData() {
    try {
      await set(ref(db, '/'), {
        transaksiKonter,
        transaksiWarung,
        pengeluaran,
        tarikTunai,
        daftarBarangAdmin
      });
    } catch (error) {
      alert('Gagal menyimpan data ke Firebase: ' + error.message);
    }
  }

  function renderTableKonter() {
    const tbody = document.querySelector('#tableKonter tbody');
    tbody.innerHTML = '';
    transaksiKonter.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${item.harga}</td>
        <td>${item.fee}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-btn" data-tab="konter" data-index="${i}">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderTableWarung() {
    const tbody = document.querySelector('#tableWarung tbody');
    tbody.innerHTML = '';
    transaksiWarung.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${item.harga}</td>
        <td>${item.fee}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-btn" data-tab="warung" data-index="${i}">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderTablePengeluaran() {
    const tbody = document.querySelector('#tablePengeluaran tbody');
    tbody.innerHTML = '';
    pengeluaran.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${item.harga}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-btn" data-tab="pengeluaran" data-index="${i}">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderTableTarikTunai() {
    const tbody = document.querySelector('#tableTarikTunai tbody');
    tbody.innerHTML = '';
    tarikTunai.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.keterangan}</td>
        <td>${item.jumlah}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-btn" data-tab="tariktunai" data-index="${i}">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderTableAdminBarang(filter = '') {
    const tbody = document.querySelector('#tableAdminBarang tbody');
    tbody.innerHTML = '';
    const filtered = daftarBarangAdmin.filter(b => b.nama.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${item.hargaBeli}</td>
        <td>${item.hargaJual}</td>
        <td><button class="delete-btn" data-tab="admin" data-index="${i}">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Calculate total keuntungan
  function updateTotalKeuntungan() {
    // As contoh: total keuntungan = total penjualan - total pengeluaran - total tarik tunai
    const totalPenjualanKonter = transaksiKonter.reduce((acc, cur) => acc + Number(cur.harga) - Number(cur.fee), 0);
    const totalPenjualanWarung = transaksiWarung.reduce((acc, cur) => acc + Number(cur.harga) - Number(cur.fee), 0);
    const totalPengeluaran = pengeluaran.reduce((acc, cur) => acc + Number(cur.harga), 0);
    const totalTarikTunai = tarikTunai.reduce((acc, cur) => acc + Number(cur.jumlah), 0);

    const total = totalPenjualanKonter + totalPenjualanWarung - totalPengeluaran - totalTarikTunai;

    document.getElementById('totalKeuntungan').textContent = total.toLocaleString('id-ID');
  }

  // Event listeners forms

  document.getElementById('formKonter').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangKonter').value.trim();
    const harga = Number(document.getElementById('hargaKonter').value);
    const fee = Number(document.getElementById('feeKonter').value);
    if (!nama || harga < 0 || fee < 0) return alert('Data tidak valid!');
    transaksiKonter.push({
      nama,
      harga,
      fee,
      tanggal: new Date().toLocaleString()
    });
    saveData().then(() => {
      renderTableKonter();
      updateTotalKeuntungan();
      e.target.reset();
    });
  });

  document.getElementById('formWarung').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangWarung').value.trim();
    const harga = Number(document.getElementById('hargaWarung').value);
    const fee = Number(document.getElementById('feeWarung').value);
    if (!nama || harga < 0 || fee < 0) return alert('Data tidak valid!');
    transaksiWarung.push({
      nama,
      harga,
      fee,
      tanggal: new Date().toLocaleString()
    });
    saveData().then(() => {
      renderTableWarung();
      updateTotalKeuntungan();
      e.target.reset();
    });
  });

  document.getElementById('formPengeluaran').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaPengeluaran').value.trim();
    const harga = Number(document.getElementById('hargaPengeluaran').value);
    if (!nama || harga < 0) return alert('Data tidak valid!');
    pengeluaran.push({
      nama,
      harga,
      tanggal: new Date().toLocaleString()
    });
    saveData().then(() => {
      renderTablePengeluaran();
      updateTotalKeuntungan();
      e.target.reset();
    });
  });

  document.getElementById('formTarikTunai').addEventListener('submit', e => {
    e.preventDefault();
    const keterangan = document.getElementById('namaTarikTunai').value.trim();
    const jumlah = Number(document.getElementById('hargaTarikTunai').value);
    if (!keterangan || jumlah < 0) return alert('Data tidak valid!');
    tarikTunai.push({
      keterangan,
      jumlah,
      tanggal: new Date().toLocaleString()
    });
    saveData().then(() => {
      renderTableTarikTunai();
      updateTotalKeuntungan();
      e.target.reset();
    });
  });

  document.getElementById('formAdminBarang').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangAdmin').value.trim();
    const hargaBeli = Number(document.getElementById('hargaBeliAdmin').value);
    const hargaJual = Number(document.getElementById('hargaJualAdmin').value);
    if (!nama || hargaBeli < 0 || hargaJual < 0) return alert('Data tidak valid!');
    daftarBarangAdmin.push({ nama, hargaBeli, hargaJual });
    saveData().then(() => {
      renderTableAdminBarang();
      e.target.reset();
    });
  });

  // Delete button handler (event delegation)
  document.body.addEventListener('click', e => {
    if (e.target.classList.contains('delete-btn')) {
      const tab = e.target.dataset.tab;
      const index = Number(e.target.dataset.index);
      if (isNaN(index)) return;
      switch (tab) {
        case 'konter':
          transaksiKonter.splice(index, 1);
          renderTableKonter();
          break;
        case 'warung':
          transaksiWarung.splice(index, 1);
          renderTableWarung();
          break;
        case 'pengeluaran':
          pengeluaran.splice(index, 1);
          renderTablePengeluaran();
          break;
        case 'tariktunai':
          tarikTunai.splice(index, 1);
          renderTableTarikTunai();
          break;
        case 'admin':
          daftarBarangAdmin.splice(index, 1);
          renderTableAdminBarang();
          break;
      }
      saveData().then(updateTotalKeuntungan);
    }
  });

  // Search admin barang
  document.getElementById('searchBarang').addEventListener('input', e => {
    renderTableAdminBarang(e.target.value);
  });

  // Inisialisasi data dan render saat halaman siap
  loadData().then(() => {
    renderTableKonter();
    renderTableWarung();
    renderTablePengeluaran();
    renderTableTarikTunai();
    renderTableAdminBarang();
    updateTotalKeuntungan();
  });
</script>
</body>
</html>
