<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Website Pembukuan</title>
  <style>
    /* Style sidebar kiri */
    body {
      margin: 0; 
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }
    #sidebar {
      width: 220px;
      background-color: #2c3e50;
      color: white;
      display: flex;
      flex-direction: column;
    }
    #sidebar h2 {
      text-align: center;
      padding: 1rem 0;
      margin: 0;
      background: #1a252f;
    }
    #sidebar button {
      background: none;
      border: none;
      color: white;
      padding: 1rem;
      text-align: left;
      cursor: pointer;
      font-size: 1rem;
      border-bottom: 1px solid #34495e;
      width: 100%;
    }
    #sidebar button.active, #sidebar button:hover {
      background-color: #34495e;
    }
    #content {
      flex-grow: 1;
      padding: 1rem;
      overflow-y: auto;
    }
    /* Form styling */
    form {
      margin-bottom: 1rem;
    }
    form input {
      padding: 0.5rem;
      margin-right: 0.5rem;
      font-size: 1rem;
    }
    form button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    /* Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 0.5rem;
      text-align: left;
    }
    /* Responsive */
    @media (max-width: 600px) {
      body {
        flex-direction: column;
      }
      #sidebar {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
      }
      #sidebar button {
        flex-grow: 1;
        text-align: center;
        border-bottom: none;
        border-right: 1px solid #34495e;
      }
    }
  </style>
</head>
<body>

  <div id="sidebar">
    <h2>Menu</h2>
    <button class="tabBtn active" data-tab="konter">Transaksi Konter</button>
    <button class="tabBtn" data-tab="warung">Transaksi Warung</button>
    <button class="tabBtn" data-tab="tarikTunai">Tarik Tunai</button>
    <button class="tabBtn" data-tab="pengeluaran">Pengeluaran</button>
    <button class="tabBtn" data-tab="adminBarang">Admin Barang</button>
    <button class="tabBtn" data-tab="laporan">Laporan</button>
  </div>

  <div id="content">

    <!-- Form Konter -->
    <div class="tabContent" id="konter" style="display: block;">
      <h3>Transaksi Konter</h3>
      <form id="formKonter">
        <input type="text" id="namaBarangKonter" placeholder="Nama Barang" required />
        <input type="number" id="hargaKonter" placeholder="Harga Jual" min="0" required />
        <input type="number" id="feeKonter" placeholder="Fee" min="0" required />
        <button type="submit">Tambah</button>
        <button type="button" class="btnBatal" data-form="formKonter">Batal</button>
      </form>
      <table id="tableKonter">
        <thead><tr><th>Nama Barang</th><th>Harga Jual</th><th>Fee</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Form Warung -->
    <div class="tabContent" id="warung" style="display:none;">
      <h3>Transaksi Warung</h3>
      <form id="formWarung">
        <input type="text" id="namaBarangWarung" placeholder="Nama Barang" required />
        <input type="number" id="hargaWarung" placeholder="Harga Jual" min="0" required />
        <input type="number" id="feeWarung" placeholder="Fee" min="0" required />
        <button type="submit">Tambah</button>
        <button type="button" class="btnBatal" data-form="formWarung">Batal</button>
      </form>
      <table id="tableWarung">
        <thead><tr><th>Nama Barang</th><th>Harga Jual</th><th>Fee</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Form Tarik Tunai -->
    <div class="tabContent" id="tarikTunai" style="display:none;">
      <h3>Tarik Tunai</h3>
      <form id="formTarikTunai">
        <input type="number" id="jumlahTarikTunai" placeholder="Jumlah Tarik Tunai" min="0" required />
        <input type="number" id="feeTarikTunai" placeholder="Fee" min="0" required />
        <button type="submit">Tambah</button>
        <button type="button" class="btnBatal" data-form="formTarikTunai">Batal</button>
      </form>
      <table id="tableTarikTunai">
        <thead><tr><th>Jumlah Tarik Tunai</th><th>Fee</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Form Pengeluaran -->
    <div class="tabContent" id="pengeluaran" style="display:none;">
      <h3>Pengeluaran</h3>
      <form id="formPengeluaran">
        <input type="text" id="namaPengeluaran" placeholder="Nama Pengeluaran" required />
        <input type="number" id="jumlahPengeluaran" placeholder="Jumlah" min="0" required />
        <button type="submit">Tambah</button>
        <button type="button" class="btnBatal" data-form="formPengeluaran">Batal</button>
      </form>
      <table id="tablePengeluaran">
        <thead><tr><th>Nama Pengeluaran</th><th>Jumlah</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Form Admin Barang -->
    <div class="tabContent" id="adminBarang" style="display:none;">
      <h3>Admin Barang</h3>
      <form id="formAdminBarang">
        <input type="text" id="namaBarangAdmin" placeholder="Nama Barang" required />
        <input type="number" id="hargaAdmin" placeholder="Harga" min="0" required />
        <input type="number" id="feeAdmin" placeholder="Fee" min="0" required />
        <button type="submit">Tambah</button>
        <button type="button" class="btnBatal" data-form="formAdminBarang">Batal</button>
      </form>
      <table id="tableAdminBarang">
        <thead><tr><th>Nama Barang</th><th>Harga</th><th>Fee</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Laporan -->
    <div class="tabContent" id="laporan" style="display:none;">
      <h3>Laporan</h3>
      <button id="btnLaporanHarian">Laporan Harian</button>
      <button id="btnLaporanBulanan">Laporan Bulanan</button>
      <div id="laporanHarian" style="display:none;">
        <h4>Laporan Harian</h4>
        <pre id="outputLaporanHarian"></pre>
      </div>
      <div id="laporanBulanan" style="display:none;">
        <h4>Laporan Bulanan</h4>
        <pre id="outputLaporanBulanan"></pre>
      </div>
    </div>

  </div>

  <!-- Firebase CDN and Initialization -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCoI53ZeXyaOBCOaczkPbHJpWzi0DX4b8g",
      authDomain: "raikicell.firebaseapp.com",
      databaseURL: "https://raikicell-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "raikicell",
      storageBucket: "raikicell.firebasestorage.app",
      messagingSenderId: "648628376778",
      appId: "1:648628376778:web:70098faf30f123ed6bd033",
      measurementId: "G-WWT1K74HHR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Utility function to format date YYYY-MM-DD
    function formatDate(date = new Date()) {
      return date.toISOString().split('T')[0];
    }
    // Utility function to format month YYYY-MM
    function formatMonth(date = new Date()) {
      return date.toISOString().slice(0,7);
    }

    // Tab switching
    const tabs = document.querySelectorAll('.tabBtn');
    const tabContents = document.querySelectorAll('.tabContent');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.style.display = 'none');

        tab.classList.add('active');
        const tabId = tab.dataset.tab;
        document.getElementById(tabId).style.display = 'block';
      });
    });

    // Data arrays
    let konterData = [];
    let warungData = [];
    let tarikTunaiData = [];
    let pengeluaranData = [];
    let adminBarangData = [];

    // Load data from Firebase realtime DB
    function loadData(path, callback) {
      const dbRef = ref(db, path);
      onValue(dbRef, snapshot => {
        const data = snapshot.val();
        callback(data ? Object.values(data) : []);
      });
    }

    // Save data to Firebase realtime DB
    function saveData(path, data) {
      push(ref(db, path), data);
    }

    // Update tables
    function updateTableKonter() {
      const tbody = document.querySelector('#tableKonter tbody');
      tbody.innerHTML = '';
      konterData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.nama}</td><td>${item.harga}</td><td>${item.fee}</td>`;
        tbody.appendChild(tr);
      });
    }
    function updateTableWarung() {
      const tbody = document.querySelector('#tableWarung tbody');
      tbody.innerHTML = '';
      warungData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.nama}</td><td>${item.harga}</td><td>${item.fee}</td>`;
        tbody.appendChild(tr);
      });
    }
    function updateTableTarikTunai() {
      const tbody = document.querySelector('#tableTarikTunai tbody');
      tbody.innerHTML = '';
      tarikTunaiData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.jumlah}</td><td>${item.fee}</td>`;
        tbody.appendChild(tr);
      });
    }
    function updateTablePengeluaran() {
      const tbody = document.querySelector('#tablePengeluaran tbody');
      tbody.innerHTML = '';
      pengeluaranData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.nama}</td><td>${item.jumlah}</td>`;
        tbody.appendChild(tr);
      });
    }
    function updateTableAdminBarang() {
      const tbody = document.querySelector('#tableAdminBarang tbody');
      tbody.innerHTML = '';
      adminBarangData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.nama}</td><td>${item.harga}</td><td>${item.fee}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Form submissions
    document.getElementById('formKonter').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaBarangKonter').value.trim();
      const harga = parseFloat(document.getElementById('hargaKonter').value);
      const fee = parseFloat(document.getElementById('feeKonter').value);
      if (nama && !isNaN(harga) && !isNaN(fee)) {
        const data = { nama, harga, fee, tanggal: formatDate() };
        saveData('konter', data);
        document.getElementById('formKonter').reset();
      }
    });

    document.getElementById('formWarung').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaBarangWarung').value.trim();
      const harga = parseFloat(document.getElementById('hargaWarung').value);
      const fee = parseFloat(document.getElementById('feeWarung').value);
      if (nama && !isNaN(harga) && !isNaN(fee)) {
        const data = { nama, harga, fee, tanggal: formatDate() };
        saveData('warung', data);
        document.getElementById('formWarung').reset();
      }
    });

    document.getElementById('formTarikTunai').addEventListener('submit', e => {
      e.preventDefault();
      const jumlah = parseFloat(document.getElementById('jumlahTarikTunai').value);
      const fee = parseFloat(document.getElementById('feeTarikTunai').value);
      if (!isNaN(jumlah) && !isNaN(fee)) {
        const data = { jumlah, fee, tanggal: formatDate() };
        saveData('tarikTunai', data);
        document.getElementById('formTarikTunai').reset();
      }
    });

    document.getElementById('formPengeluaran').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaPengeluaran').value.trim();
      const jumlah = parseFloat(document.getElementById('jumlahPengeluaran').value);
      if (nama && !isNaN(jumlah)) {
        const data = { nama, jumlah, tanggal: formatDate() };
        saveData('pengeluaran', data);
        document.getElementById('formPengeluaran').reset();
      }
    });

    document.getElementById('formAdminBarang').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaBarangAdmin').value.trim();
      const harga = parseFloat(document.getElementById('hargaAdmin').value);
      const fee = parseFloat(document.getElementById('feeAdmin').value);
      if (nama && !isNaN(harga) && !isNaN(fee)) {
        const data = { nama, harga, fee, tanggal: formatDate() };
        saveData('adminBarang', data);
        document.getElementById('formAdminBarang').reset();
      }
    });

    // Load all data initially and update tables
    function refreshAllData() {
      loadData('konter', data => {
        konterData = data;
        updateTableKonter();
        updateLaporan();
      });
      loadData('warung', data => {
        warungData = data;
        updateTableWarung();
        updateLaporan();
      });
      loadData('tarikTunai', data => {
        tarikTunaiData = data;
        updateTableTarikTunai();
        updateLaporan();
      });
      loadData('pengeluaran', data => {
        pengeluaranData = data;
        updateTablePengeluaran();
        updateLaporan();
      });
      loadData('adminBarang', data => {
        adminBarangData = data;
        updateTableAdminBarang();
        updateLaporan();
      });
    }

    refreshAllData();

    // Calculate laporan (keuntungan dan total)
    function updateLaporan() {
      // Total harga jual = konter + warung + adminBarang - tarikTunai jumlah
      const totalHargaJual =
        konterData.reduce((a,b) => a + b.harga,0) +
        warungData.reduce((a,b) => a + b.harga,0) +
        adminBarangData.reduce((a,b) => a + b.harga,0) -
        tarikTunaiData.reduce((a,b) => a + b.jumlah,0);

      // Total fee = sum fee semua transaksi + fee tarik tunai
      const totalFee =
        konterData.reduce((a,b) => a + b.fee,0) +
        warungData.reduce((a,b) => a + b.fee,0) +
        adminBarangData.reduce((a,b) => a + b.fee,0) +
        tarikTunaiData.reduce((a,b) => a + b.fee,0);

      // Total pengeluaran
      const totalPengeluaran = pengeluaranData.reduce((a,b) => a + b.jumlah,0);

      // Keuntungan = (harga jual - fee) - pengeluaran
      const keuntungan = (totalHargaJual - totalFee) - totalPengeluaran;

      window.laporanSummary = {
        totalHargaJual,
        totalFee,
        totalPengeluaran,
        keuntungan
      };
    }

    // Laporan harian
    document.getElementById('btnLaporanHarian').addEventListener('click', () => {
      const today = formatDate();
      const laporan = generateLaporan('hari', today);
      document.getElementById('laporanHarian').style.display = 'block';
      document.getElementById('laporanBulanan').style.display = 'none';
      document.getElementById('outputLaporanHarian').textContent = laporan;
    });

    // Laporan bulanan
    document.getElementById('btnLaporanBulanan').addEventListener('click', () => {
      const thisMonth = formatMonth();
      const laporan = generateLaporan('bulan', thisMonth);
      document.getElementById('laporanHarian').style.display = 'none';
      document.getElementById('laporanBulanan').style.display = 'block';
      document.getElementById('outputLaporanBulanan').textContent = laporan;
    });

    // Generate laporan string for day or month
    function generateLaporan(type, dateStr) {
      // filter function
      function filterByDate(data) {
        return data.filter(item => {
          if(type === 'hari') {
            return item.tanggal === dateStr;
          } else if(type === 'bulan') {
            return item.tanggal.startsWith(dateStr);
          }
          return false;
        });
      }

      // Filter data
      const konterF = filterByDate(konterData);
      const warungF = filterByDate(warungData);
      const tarikTunaiF = filterByDate(tarikTunaiData);
      const pengeluaranF = filterByDate(pengeluaranData);
      const adminBarangF = filterByDate(adminBarangData);

      // Calculate
      const totalHargaJual =
        konterF.reduce((a,b) => a + b.harga,0) +
        warungF.reduce((a,b) => a + b.harga,0) +
        adminBarangF.reduce((a,b) => a + b.harga,0) -
        tarikTunaiF.reduce((a,b) => a + b.jumlah,0);

      const totalFee =
        konterF.reduce((a,b) => a + b.fee,0) +
        warungF.reduce((a,b) => a + b.fee,0) +
        adminBarangF.reduce((a,b) => a + b.fee,0) +
        tarikTunaiF.reduce((a,b) => a + b.fee,0);

      const totalPengeluaran = pengeluaranF.reduce((a,b) => a + b.jumlah,0);

      const keuntungan = (totalHargaJual - totalFee) - totalPengeluaran;

      return `
Laporan ${type === 'hari' ? 'Harian' : 'Bulanan'} untuk ${dateStr}:
- Total Harga Jual: ${totalHargaJual}
- Total Fee: ${totalFee}
- Total Pengeluaran: ${totalPengeluaran}
- Keuntungan Bersih: ${keuntungan}
      `.trim();
    }

    // Tombol batal di semua form
    const tombolBatal = document.querySelectorAll('.btnBatal');
    tombolBatal.forEach(btn => {
      btn.addEventListener('click', () => {
        const formId = btn.dataset.form;
        document.getElementById(formId).reset();
      });
    });

  </script>

</body>
</html>
