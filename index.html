<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>POS Kasir Usaha</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
    background: #f5f5f5;
  }
  #sidebar {
    width: 230px;
    background: #2c3e50;
    color: white;
    display: flex;
    flex-direction: column;
  }
  #sidebar h2 {
    margin: 20px;
    font-weight: normal;
  }
  #sidebar button {
    background: none;
    border: none;
    color: white;
    padding: 15px 20px;
    text-align: left;
    font-size: 16px;
    cursor: pointer;
    border-left: 5px solid transparent;
    transition: background 0.3s, border-color 0.3s;
  }
  #sidebar button.active, #sidebar button:hover {
    background: #34495e;
    border-left-color: #e67e22;
  }
  #content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    background: white;
  }
  h3 {
    margin-top: 0;
  }
  form {
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  input[type=text], input[type=number], input[type=date] {
    width: 100%;
    padding: 6px 8px;
    margin-top: 4px;
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  button.submit-btn {
    margin-top: 15px;
    padding: 10px 15px;
    background: #27ae60;
    border: none;
    color: white;
    font-size: 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button.submit-btn:hover {
    background: #219150;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table thead {
    background: #2980b9;
    color: white;
  }
  table th, table td {
    padding: 8px 10px;
    border: 1px solid #ddd;
    text-align: left;
    font-size: 14px;
  }
  table tbody tr:nth-child(even) {
    background: #f9f9f9;
  }
  .delete-button {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 5px 9px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 13px;
  }
  .delete-button:hover {
    background: #c0392b;
  }
  .info-box {
    margin: 15px 0;
    padding: 10px 15px;
    background: #ecf0f1;
    border-radius: 5px;
    font-weight: bold;
    font-size: 16px;
  }
  .filter-section {
    margin-bottom: 10px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .filter-section input {
    max-width: 150px;
  }
  @media (max-width: 700px) {
    body {
      flex-direction: column;
      height: auto;
    }
    #sidebar {
      width: 100%;
      flex-direction: row;
      overflow-x: auto;
    }
    #sidebar button {
      flex: 1;
      border-left: none;
      border-bottom: 5px solid transparent;
      text-align: center;
    }
    #sidebar button.active, #sidebar button:hover {
      border-left-color: transparent;
      border-bottom-color: #e67e22;
    }
    #content {
      height: auto;
      padding: 10px;
    }
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Menu</h2>
  <button class="tab-btn active" data-tab="konter">Transaksi Konter</button>
  <button class="tab-btn" data-tab="warung">Transaksi Warung</button>
  <button class="tab-btn" data-tab="tarik-tunai">Tarik Tunai</button>
  <button class="tab-btn" data-tab="pengeluaran">Pengeluaran</button>
  <button class="tab-btn" data-tab="admin">Admin (Barang)</button>
  <button class="tab-btn" data-tab="laporan">Laporan</button>
</div>

<div id="content">

  <!-- Transaksi Konter -->
  <section class="tab-content" id="konter" style="display:block;">
    <h3>Transaksi Konter</h3>
    <form id="formKonter">
      <label>Nama Barang</label>
      <input type="text" id="namaBarangKonter" required placeholder="Nama barang" autocomplete="off" />
      <label>Harga</label>
      <input type="number" id="hargaKonter" required min="0" />
      <label>Fee</label>
      <input type="number" id="feeKonter" required min="0" />
      <button class="submit-btn" type="submit">Tambah Transaksi</button>
    </form>
    <table id="tableKonter">
      <thead>
        <tr>
          <th>Nama Barang</th>
          <th>Harga</th>
          <th>Fee</th>
          <th>Tanggal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Transaksi Warung -->
  <section class="tab-content" id="warung" style="display:none;">
    <h3>Transaksi Warung</h3>
    <form id="formWarung">
      <label>Nama Barang</label>
      <input type="text" id="namaBarangWarung" required placeholder="Nama barang" autocomplete="off" />
      <label>Harga</label>
      <input type="number" id="hargaWarung" required min="0" />
      <label>Fee</label>
      <input type="number" id="feeWarung" required min="0" />
      <button class="submit-btn" type="submit">Tambah Transaksi</button>
    </form>
    <table id="tableWarung">
      <thead>
        <tr>
          <th>Nama Barang</th>
          <th>Harga</th>
          <th>Fee</th>
          <th>Tanggal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Tarik Tunai -->
  <section class="tab-content" id="tarik-tunai" style="display:none;">
    <h3>Transaksi Tarik Tunai</h3>
    <form id="formTarikTunai">
      <label>Jumlah Tarik Tunai</label>
      <input type="number" id="jumlahTarikTunai" required min="0" />
      <label>Fee</label>
      <input type="number" id="feeTarikTunai" required min="0" />
      <button class="submit-btn" type="submit">Tambah Tarik Tunai</button>
    </form>
    <table id="tableTarikTunai">
      <thead>
        <tr>
          <th>Jumlah</th>
          <th>Fee</th>
          <th>Tanggal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Pengeluaran -->
  <section class="tab-content" id="pengeluaran" style="display:none;">
    <h3>Pengeluaran</h3>
    <form id="formPengeluaran">
      <label>Nama Pengeluaran</label>
      <input type="text" id="namaPengeluaran" required placeholder="Nama pengeluaran" autocomplete="off" />
      <label>Jumlah</label>
      <input type="number" id="jumlahPengeluaran" required min="0" />
      <button class="submit-btn" type="submit">Tambah Pengeluaran</button>
    </form>
    <table id="tablePengeluaran">
      <thead>
        <tr>
          <th>Nama Pengeluaran</th>
          <th>Jumlah</th>
          <th>Tanggal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Admin Barang -->
  <section class="tab-content" id="admin" style="display:none;">
    <h3>Admin - Daftar Barang</h3>
    <form id="formAdmin">
      <label>Nama Barang</label>
      <input type="text" id="namaBarangAdmin" required placeholder="Nama barang" autocomplete="off" />
      <label>Harga</label>
      <input type="number" id="hargaAdmin" required min="0" />
      <label>Fee</label>
      <input type="number" id="feeAdmin" required min="0" />
      <button class="submit-btn" type="submit">Tambah Barang</button>
    </form>
    <input type="text" id="searchBarang" placeholder="Cari barang..." style="width:100%; margin-top: 10px; padding: 6px 8px; font-size: 14px; border-radius:4px; border:1px solid #ccc;">
    <table id="tableAdmin">
      <thead>
        <tr>
          <th>Nama Barang</th>
          <th>Harga</th>
          <th>Fee</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Laporan -->
  <section class="tab-content" id="laporan" style="display:none;">
    <h3>Laporan</h3>
    <div>
      <div style="margin-bottom:15px;">
        <label><b>Laba Kotor:</b> <span id="totalLabaKotor">0</span></label><br />
        <label><b>Laba Bersih:</b> <span id="totalLabaBersih">0</span></label>
      </div>
      <hr>
      <h4>Laporan Harian</h4>
      <input type="date" id="tanggalLaporanHarian" />
      <button class="submit-btn" id="btnGenerateLaporanHarian">Tampilkan Laporan Harian</button>
      <div id="laporanHarianResult" style="margin-top:10px; font-weight:bold;"></div>
      <hr>
      <h4>Laporan Bulanan</h4>
      <input type="month" id="bulanLaporanBulanan" />
      <button class="submit-btn" id="btnGenerateLaporanBulanan">Tampilkan Laporan Bulanan</button>
      <div id="laporanBulananResult" style="margin-top:10px; font-weight:bold;"></div>
    </div>
  </section>

</div>

<script>
(() => {
  // Data arrays
  let transaksiKonter = [];
  let transaksiWarung = [];
  let pengeluaran = [];
  let tarikTunai = [];
  let daftarBarangAdmin = [];

  // DOM shortcuts
  const tabButtons = document.querySelectorAll('#sidebar .tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  // Load data from localStorage
  function loadData() {
    transaksiKonter = JSON.parse(('transaksiKonter') || '[]');
    transaksiWarung = JSON.parse(('transaksiWarung') || '[]');
    pengeluaran = JSON.parse(('pengeluaran') || '[]');
    tarikTunai = JSON.parse(('tarikTunai') || '[]');
    daftarBarangAdmin = JSON.parse(('daftarBarangAdmin') || '[]');
  }
  // Save data to localStorage
  function saveData() {
    ('transaksiKonter', JSON.stringify(transaksiKonter));
    ('transaksiWarung', JSON.stringify(transaksiWarung));
    ('pengeluaran', JSON.stringify(pengeluaran));
    ('tarikTunai', JSON.stringify(tarikTunai));
    ('daftarBarangAdmin', JSON.stringify(daftarBarangAdmin));
  }

  // Format number to rupiah currency style
  function formatRupiah(num) {
    return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  }

  // Render tables
  function renderTableKonter() {
    const tbody = document.querySelector('#tableKonter tbody');
    tbody.innerHTML = '';
    transaksiKonter.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${formatRupiah(item.harga)}</td>
        <td>${formatRupiah(item.fee)}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-button" data-index="${i}" data-type="konter">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderTableWarung() {
    const tbody = document.querySelector('#tableWarung tbody');
    tbody.innerHTML = '';
    transaksiWarung.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${formatRupiah(item.harga)}</td>
        <td>${formatRupiah(item.fee)}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-button" data-index="${i}" data-type="warung">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderTablePengeluaran() {
    const tbody = document.querySelector('#tablePengeluaran tbody');
    tbody.innerHTML = '';
    pengeluaran.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.nama}</td>
        <td>${formatRupiah(item.jumlah)}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-button" data-index="${i}" data-type="pengeluaran">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderTableTarikTunai() {
    const tbody = document.querySelector('#tableTarikTunai tbody');
    tbody.innerHTML = '';
    tarikTunai.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${formatRupiah(item.jumlah)}</td>
        <td>${formatRupiah(item.fee)}</td>
        <td>${item.tanggal}</td>
        <td><button class="delete-button" data-index="${i}" data-type="tarikTunai">Hapus</button></td>
      `;
      tbody.appendChild(tr);
    });
  }
  function renderTableAdmin(filter = '') {
    const tbody = document.querySelector('#tableAdmin tbody');
    tbody.innerHTML = '';
    const lowerFilter = filter.toLowerCase();
    daftarBarangAdmin.forEach((item, i) => {
      if (item.nama.toLowerCase().includes(lowerFilter)) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.nama}</td>
          <td>${formatRupiah(item.harga)}</td>
          <td>${formatRupiah(item.fee)}</td>
          <td><button class="delete-button" data-index="${i}" data-type="admin">Hapus</button></td>
        `;
        tbody.appendChild(tr);
      }
    });
  }

  // Update laba kotor dan laba bersih
  function updateLaba() {
    let labaKotor = 0;
    let labaBersih = 0;

    transaksiKonter.forEach(d => {
      labaKotor += d.harga + d.fee;
      labaBersih += d.fee;
    });
    transaksiWarung.forEach(d => {
      labaKotor += d.harga + d.fee;
      labaBersih += d.fee;
    });
    pengeluaran.forEach(d => {
      labaKotor -= d.jumlah;
    });
    tarikTunai.forEach(d => {
      labaKotor -= d.jumlah;
      labaBersih += d.fee;
    });

    document.getElementById('totalLabaKotor').textContent = formatRupiah(labaKotor);
    document.getElementById('totalLabaBersih').textContent = formatRupiah(labaBersih);
  }

  // Hapus item handler
  function deleteItem(type, index) {
    if (!confirm('Yakin hapus data ini?')) return;
    switch(type) {
      case 'konter': transaksiKonter.splice(index, 1); break;
      case 'warung': transaksiWarung.splice(index, 1); break;
      case 'pengeluaran': pengeluaran.splice(index, 1); break;
      case 'tarikTunai': tarikTunai.splice(index, 1); break;
      case 'admin': daftarBarangAdmin.splice(index, 1); break;
    }
    saveData();
    renderAll();
  }

  // Render semua tabel dan update laba
  function renderAll() {
    renderTableKonter();
    renderTableWarung();
    renderTablePengeluaran();
    renderTableTarikTunai();
    renderTableAdmin(document.getElementById('searchBarang').value);
    updateLaba();
  }

  // Event Listeners

  // Tab switching
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      tabContents.forEach(c => c.style.display = 'none');
      document.getElementById(btn.dataset.tab).style.display = 'block';
    });
  });

  // Form konter submit
  document.getElementById('formKonter').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangKonter').value.trim();
    const harga = parseInt(document.getElementById('hargaKonter').value);
    const fee = parseInt(document.getElementById('feeKonter').value);
    if (!nama || isNaN(harga) || isNaN(fee) || harga < 0 || fee < 0) return alert('Input tidak valid!');
    transaksiKonter.push({
      nama, harga, fee,
      tanggal: new Date().toISOString().slice(0,10)
    });
    saveData();
    renderAll();
    e.target.reset();
  });

  // Form warung submit
  document.getElementById('formWarung').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangWarung').value.trim();
    const harga = parseInt(document.getElementById('hargaWarung').value);
    const fee = parseInt(document.getElementById('feeWarung').value);
    if (!nama || isNaN(harga) || isNaN(fee) || harga < 0 || fee < 0) return alert('Input tidak valid!');
    transaksiWarung.push({
      nama, harga, fee,
      tanggal: new Date().toISOString().slice(0,10)
    });
    saveData();
    renderAll();
    e.target.reset();
  });

  // Form tarik tunai submit
  document.getElementById('formTarikTunai').addEventListener('submit', e => {
    e.preventDefault();
    const jumlah = parseInt(document.getElementById('jumlahTarikTunai').value);
    const fee = parseInt(document.getElementById('feeTarikTunai').value);
    if (isNaN(jumlah) || isNaN(fee) || jumlah < 0 || fee < 0) return alert('Input tidak valid!');
    tarikTunai.push({
      jumlah, fee,
      tanggal: new Date().toISOString().slice(0,10)
    });
    saveData();
    renderAll();
    e.target.reset();
  });

  // Form pengeluaran submit
  document.getElementById('formPengeluaran').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaPengeluaran').value.trim();
    const jumlah = parseInt(document.getElementById('jumlahPengeluaran').value);
    if (!nama || isNaN(jumlah) || jumlah < 0) return alert('Input tidak valid!');
    pengeluaran.push({
      nama, jumlah,
      tanggal: new Date().toISOString().slice(0,10)
    });
    saveData();
    renderAll();
    e.target.reset();
  });

  // Form admin barang submit
  document.getElementById('formAdmin').addEventListener('submit', e => {
    e.preventDefault();
    const nama = document.getElementById('namaBarangAdmin').value.trim();
    const harga = parseInt(document.getElementById('hargaAdmin').value);
    const fee = parseInt(document.getElementById('feeAdmin').value);
    if (!nama || isNaN(harga) || isNaN(fee) || harga < 0 || fee < 0) return alert('Input tidak valid!');
    daftarBarangAdmin.push({nama, harga, fee});
    saveData();
    renderAll();
    e.target.reset();
  });

  // Delete button event delegation
  document.body.addEventListener('click', e => {
    if (e.target.classList.contains('delete-button')) {
      const idx = parseInt(e.target.dataset.index);
      const type = e.target.dataset.type;
      deleteItem(type, idx);
    }
  });

  // Search barang admin
  document.getElementById('searchBarang').addEventListener('input', e => {
    renderTableAdmin(e.target.value);
  });

  // Laporan harian generate
  document.getElementById('btnGenerateLaporanHarian').addEventListener('click', () => {
    const tanggal = document.getElementById('tanggalLaporanHarian').value;
    if (!tanggal) return alert('Pilih tanggal terlebih dahulu');
    let labaKotor = 0;
    let labaBersih = 0;

    // Hitung berdasarkan transaksi hari itu
    transaksiKonter.forEach(d => {
      if (d.tanggal === tanggal) {
        labaKotor += d.harga + d.fee;
        labaBersih += d.fee;
      }
    });
    transaksiWarung.forEach(d => {
      if (d.tanggal === tanggal) {
        labaKotor += d.harga + d.fee;
        labaBersih += d.fee;
      }
    });
    pengeluaran.forEach(d => {
      if (d.tanggal === tanggal) {
        labaKotor -= d.jumlah;
      }
    });
    tarikTunai.forEach(d => {
      if (d.tanggal === tanggal) {
        labaKotor -= d.jumlah;
        labaBersih += d.fee;
      }
    });

    const hasil = `Laba Kotor: ${formatRupiah(labaKotor)} | Laba Bersih: ${formatRupiah(labaBersih)}`;
    document.getElementById('laporanHarianResult').textContent = hasil;
  });

  // Laporan bulanan generate
  document.getElementById('btnGenerateLaporanBulanan').addEventListener('click', () => {
    const bulan = document.getElementById('bulanLaporanBulanan').value;
    if (!bulan) return alert('Pilih bulan terlebih dahulu');

    // bulan format yyyy-mm
    let labaKotor = 0;
    let labaBersih = 0;

    function isInMonth(dateStr) {
      return dateStr.startsWith(bulan);
    }

    transaksiKonter.forEach(d => {
      if (isInMonth(d.tanggal)) {
        labaKotor += d.harga + d.fee;
        labaBersih += d.fee;
      }
    });
    transaksiWarung.forEach(d => {
      if (isInMonth(d.tanggal)) {
        labaKotor += d.harga + d.fee;
        labaBersih += d.fee;
      }
    });
    pengeluaran.forEach(d => {
      if (isInMonth(d.tanggal)) {
        labaKotor -= d.jumlah;
      }
    });
    tarikTunai.forEach(d => {
      if (isInMonth(d.tanggal)) {
        labaKotor -= d.jumlah;
        labaBersih += d.fee;
      }
    });

    const hasil = `Laba Kotor Bulanan: ${formatRupiah(labaKotor)} | Laba Bersih Bulanan: ${formatRupiah(labaBersih)}`;
    document.getElementById('laporanBulananResult').textContent = hasil;
  });

  // Init load
  loadData();
  renderAll();
})();
</script>
<!-- LOGIN OVERLAY -->
<style>
  #loginOverlay {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999;
  }
  #loginBox {
    background: white; padding: 20px; border-radius: 8px; width: 300px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    font-family: Arial, sans-serif;
  }
  #loginBox input {
    width: 100%; margin: 10px 0; padding: 10px; box-sizing: border-box;
  }
  #loginBox button {
    width: 100%; padding: 10px; background: #4CAF50; color: white;
    border: none; cursor: pointer;
  }
  #loginBox button:hover {
    background: #45a049;
  }
  #errorMsg {
    color: red; font-size: 0.9em; height: 1.2em;
  }
  body.not-logged-in > *:not(#loginOverlay) {
    display: none !important;
  }
</style>

<div id="loginOverlay">
  <div id="loginBox">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" autocomplete="off" />
    <input type="password" id="password" placeholder="Password" autocomplete="off" />
    <button id="loginBtn">Login</button>
    <div id="errorMsg"></div>
  </div>
</div>

<script>
  // User & pass yang diberikan
  const validUsername = "AE366813";
  const validPassword = "Raikicell1909";

  const loginOverlay = document.getElementById('loginOverlay');
  const errorMsg = document.getElementById('errorMsg');
  const loginBtn = document.getElementById('loginBtn');

  // Tampilkan login overlay dan sembunyikan isi asli sampai login benar
  document.body.classList.add('not-logged-in');

  loginBtn.addEventListener('click', () => {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (username === validUsername && password === validPassword) {
      // Login sukses
      document.body.classList.remove('not-logged-in');
      loginOverlay.style.display = 'none';
      sessionStorage.setItem('loggedIn', 'true');
    } else {
      errorMsg.textContent = 'Username atau password salah!';
    }
  });

  // Jika sudah login sebelumnya, langsung sembunyikan login
  if (sessionStorage.getItem('loggedIn') === 'true') {
    document.body.classList.remove('not-logged-in');
    loginOverlay.style.display = 'none';
  }
</script>

</body>
</html>
